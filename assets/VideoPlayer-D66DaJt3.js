import{j as t}from"./jsx-runtime-BjG_zV1W.js";import{n as ye,a as Ae,p as ke,c as xe,s as Oe,b as Ie,d as we,e as Ve,f as je,g as _e,h as Pe}from"./SpeakerX.es-Cg-mjUf1.js";import{r as n}from"./index-BVDOR7y2.js";import{V as r}from"./components-BrxBU25R.js";import{e as $e,i as Me}from"./index-kdCLY6-3.js";function De({videoRef:s,canvasRef:S,enabled:c,blur:h=60,opacity:g=.6,scale:E=1.2}){const u=n.useRef(60);return n.useEffect(()=>{if(!c||!s.current||!S.current)return;const i=s.current,v=S.current,y=v.getContext("2d");if(!y)return;const A=()=>{if(!i||!v||!y)return;const C=i.getBoundingClientRect();v.width=C.width*E,v.height=C.height*E,y.filter=`blur(${h}px)`,y.globalAlpha=g;try{y.drawImage(i,0,0,v.width,v.height)}catch{}c&&(u.current=requestAnimationFrame(A))},m=()=>{c&&A()},T=()=>{u.current&&cancelAnimationFrame(u.current)};return i.addEventListener("play",m),i.addEventListener("pause",T),i.addEventListener("ended",T),i.paused||m(),()=>{i.removeEventListener("play",m),i.removeEventListener("pause",T),i.removeEventListener("ended",T),u.current&&cancelAnimationFrame(u.current)}},[c,h,g,E,s,S]),{isActive:c}}function Be({videoRef:s,containerRef:S,onPlay:c,onPause:h,onEnded:g,onTimeUpdate:E,onVolumeChange:u,onFullscreenChange:i,onError:v,playbackRates:y=[.5,.75,1,1.25,1.5,2],quality:A}){const[m,T]=n.useState(!1),[C,ce]=n.useState(0),[b,fe]=n.useState(0),[G,Q]=n.useState(1),[X,R]=n.useState(!1),[J,pe]=n.useState(!1),[U,o]=n.useState(!1),[_,P]=n.useState(!1),[Z,F]=n.useState(0),[x,z]=n.useState(1),[ue,he]=n.useState((A==null?void 0:A[0])||null),[Y,$]=n.useState(!0),k=n.useRef(null),O=n.useCallback(()=>{k.current&&clearTimeout(k.current),$(!0),k.current=setTimeout(()=>{m&&$(!1)},3e3)},[m]),M=n.useCallback(async()=>{if(s.current)try{await s.current.play(),T(!0),c==null||c()}catch(e){console.error("Error playing video:",e)}},[s,c]),I=n.useCallback(()=>{s.current&&(s.current.pause(),T(!1),h==null||h())},[s,h]),W=n.useCallback(()=>{m?I():M()},[m,M,I]),D=n.useCallback(e=>{s.current&&(s.current.currentTime=Math.max(0,Math.min(e,b)))},[s,b]),K=n.useCallback(e=>{const l=Math.max(0,Math.min(1,e));s.current&&(s.current.volume=l,Q(l),R(l===0),u==null||u(l))},[s,u]),ee=n.useCallback(()=>{if(s.current){const e=!X;s.current.muted=e,R(e)}},[s,X]),B=n.useCallback(async()=>{if(S.current)try{J?document.exitFullscreen&&await document.exitFullscreen():S.current.requestFullscreen&&await S.current.requestFullscreen()}catch(e){console.error("Fullscreen error:",e)}},[S,J]),ve=n.useCallback(async()=>{if(s.current)try{U?document.exitPictureInPicture&&await document.exitPictureInPicture():s.current.requestPictureInPicture&&await s.current.requestPictureInPicture()}catch(e){console.error("Picture-in-picture error:",e)}},[s,U]),te=n.useCallback(e=>{s.current&&y.includes(e)&&(s.current.playbackRate=e,z(e))},[s,y]),w=n.useCallback(e=>{if(s.current&&A){const l=s.current.currentTime,d=!s.current.paused;s.current.src=e.src,s.current.currentTime=l,d&&s.current.play(),he(e)}},[s,A]),q=n.useCallback(e=>{const l=Math.floor(e/3600),d=Math.floor(e%3600/60),j=Math.floor(e%60);return l>0?`${l}:${d.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`:`${d}:${j.toString().padStart(2,"0")}`},[]),ae=n.useCallback(()=>b>0?C/b*100:0,[C,b]),re=n.useCallback(()=>b>0?Z/b*100:0,[Z,b]);return n.useEffect(()=>{const e=s.current;if(!e)return;const l=()=>P(!0),d=()=>P(!1),j=()=>{fe(e.duration),Q(e.volume),R(e.muted)},ne=()=>{ce(e.currentTime),E==null||E(e.currentTime)},oe=()=>{e.buffered.length>0&&F(e.buffered.end(e.buffered.length-1))},se=()=>{T(!0),c==null||c()},de=()=>{T(!1),h==null||h()},V=()=>{T(!1),g==null||g()},H=()=>{Q(e.volume),R(e.muted),u==null||u(e.volume)},le=Ee=>{P(!1),v==null||v(Ee)},Se=()=>o(!0),me=()=>o(!1);return e.addEventListener("loadstart",l),e.addEventListener("canplay",d),e.addEventListener("loadedmetadata",j),e.addEventListener("timeupdate",ne),e.addEventListener("progress",oe),e.addEventListener("play",se),e.addEventListener("pause",de),e.addEventListener("ended",V),e.addEventListener("volumechange",H),e.addEventListener("error",le),e.addEventListener("enterpictureinpicture",Se),e.addEventListener("leavepictureinpicture",me),()=>{e.removeEventListener("loadstart",l),e.removeEventListener("canplay",d),e.removeEventListener("loadedmetadata",j),e.removeEventListener("timeupdate",ne),e.removeEventListener("progress",oe),e.removeEventListener("play",se),e.removeEventListener("pause",de),e.removeEventListener("ended",V),e.removeEventListener("volumechange",H),e.removeEventListener("error",le),e.removeEventListener("enterpictureinpicture",Se),e.removeEventListener("leavepictureinpicture",me)}},[s,c,h,g,E,u,v]),n.useEffect(()=>{const e=()=>{const l=!!document.fullscreenElement;pe(l),i==null||i(l)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[i]),n.useEffect(()=>{const e=l=>{var d;if((d=S.current)!=null&&d.contains(document.activeElement))switch(l.code){case"Space":l.preventDefault(),W();break;case"ArrowLeft":l.preventDefault(),D(C-10);break;case"ArrowRight":l.preventDefault(),D(C+10);break;case"ArrowUp":l.preventDefault(),K(Math.min(1,G+.1));break;case"ArrowDown":l.preventDefault(),K(Math.max(0,G-.1));break;case"KeyM":l.preventDefault(),ee();break;case"KeyF":l.preventDefault(),B();break}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[W,D,C,K,G,ee,B,S]),n.useEffect(()=>{const e=S.current;if(!e)return;const l=()=>O(),d=()=>{k.current&&clearTimeout(k.current),m&&$(!1)};return e.addEventListener("mousemove",l),e.addEventListener("mouseleave",d),()=>{e.removeEventListener("mousemove",l),e.removeEventListener("mouseleave",d),k.current&&clearTimeout(k.current)}},[S,O,m]),{isPlaying:m,currentTime:C,duration:b,volume:G,isMuted:X,isFullscreen:J,isPictureInPicture:U,isLoading:_,buffered:Z,playbackRate:x,currentQuality:ue,showControls:Y,play:M,pause:I,togglePlay:W,seek:D,setVolume:K,toggleMute:ee,toggleFullscreen:B,togglePictureInPicture:ve,setPlaybackRate:te,setQuality:w,formatTime:q,getProgressPercentage:ae,getBufferedPercentage:re}}const Te=n.forwardRef(({src:s,type:S="video",youtubeId:c,poster:h,autoplay:g=!1,loop:E=!1,muted:u=!1,controls:i=!0,preload:v="metadata",width:y,height:A,aspectRatio:m="16:9",className:T="",onPlay:C,onPause:ce,onEnded:b,onTimeUpdate:fe,onVolumeChange:G,onFullscreenChange:Q,onError:X,showDownload:R=!1,showShare:J=!1,showSettings:pe=!0,playbackRates:U=[.5,.75,1,1.25,1.5,2],subtitles:o,quality:_,ambientMode:P=!1,...Z},F)=>{var Le;const x=n.useRef(null),z=n.useRef(null),ue=n.useRef(null),he=n.useRef(null),Y=S==="youtube"||c||s&&Me(s),$=c||(Y&&s?$e(s):null),{isPlaying:k,currentTime:O,duration:M,volume:I,isMuted:W,isFullscreen:D,isLoading:K,playbackRate:ee,currentQuality:B,showControls:ve,togglePlay:te,seek:w,setVolume:q,toggleMute:ae,toggleFullscreen:re,togglePictureInPicture:e,setPlaybackRate:l,setQuality:d,formatTime:j,getProgressPercentage:ne,getBufferedPercentage:oe}=Be({videoRef:x,containerRef:z,onPlay:C,onPause:ce,onEnded:b,onTimeUpdate:fe,onVolumeChange:G,onFullscreenChange:Q,onError:X,playbackRates:U,quality:_});De({videoRef:x,canvasRef:ue,enabled:P});const[se,de]=n.useState(!1),[V,H]=n.useState("quality"),[le,Se]=n.useState(((Le=o==null?void 0:o.find(a=>a.default))==null?void 0:Le.srcLang)||null),me=n.useCallback(a=>{const N=a.currentTarget.getBoundingClientRect(),L=(a.clientX-N.left)/N.width;w(L*M)},[M,w]),Ee=n.useCallback(a=>{const N=a.currentTarget.getBoundingClientRect(),L=(a.clientX-N.left)/N.width;q(L)},[q]),Ce=n.useCallback(()=>{if(s){const a=document.createElement("a");a.href=s,a.download="video",a.click()}},[s]),be=n.useCallback(async()=>{if(navigator.share)try{await navigator.share({title:"Video",url:window.location.href})}catch(a){console.log("Error sharing:",a)}},[]),ie=n.useCallback(a=>{const N=x.current;if(N){const L=N.textTracks;console.log("Setting subtitle:",a,"Available tracks:",L.length);for(let f=0;f<L.length;f++){const p=L[f];p&&(p.mode="hidden",console.log(`Track ${f}:`,p.language,p.label))}if(a)for(let f=0;f<L.length;f++){const p=L[f];if(p&&p.language===a){p.mode="showing",console.log("Showing track:",p.language,p.label);break}}Se(a)}},[x]);n.useEffect(()=>{const a=x.current;if(a&&o){const N=()=>{setTimeout(()=>{const f=o.find(p=>p.default);f&&ie(f.srcLang)},100)},L=()=>{if(a.textTracks.length>0){const f=o.find(p=>p.default);f&&ie(f.srcLang)}};return a.addEventListener("loadeddata",N),a.addEventListener("canplay",L),()=>{a.removeEventListener("loadeddata",N),a.removeEventListener("canplay",L)}}},[o,ie,x]);const Ne=n.useCallback(()=>{z.current&&z.current.focus()},[]),ge=n.useCallback(a=>{switch(a.key){case" ":case"k":a.preventDefault(),te();break;case"ArrowLeft":a.preventDefault(),w(O-10);break;case"ArrowRight":a.preventDefault(),w(O+10);break;case"ArrowUp":a.preventDefault(),q(Math.min(1,I+.1));break;case"ArrowDown":a.preventDefault(),q(Math.max(0,I-.1));break;case"m":a.preventDefault(),ae();break;case"f":a.preventDefault(),re();break}},[te,O,w,I,q,ae,re]);return t.jsxs("div",{ref:z,className:`${r.CLASSES.BASE} ${Y?r.CLASSES.YOUTUBE:""} ${P?r.CLASSES.AMBIENT:""} ${T}`,style:{width:y,height:A,aspectRatio:m?m.replace(":","/"):void 0},tabIndex:0,onClick:Ne,onKeyDown:ge,role:"application","aria-label":"Video player",...Z,children:[P&&t.jsx("canvas",{ref:ue,className:r.CLASSES.AMBIENT_CANVAS,"aria-hidden":"true"}),Y&&$?t.jsx("iframe",{ref:he,className:r.CLASSES.VIDEO,src:`https://www.youtube.com/embed/${$}?${new URLSearchParams({autoplay:g?"1":"0",loop:E?"1":"0",mute:u?"1":"0",controls:i?"1":"0",modestbranding:"1",rel:"0",...E&&{playlist:$}}).toString()}`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("video",{ref:a=>{x.current=a,typeof F=="function"?F(a):F&&(F.current=a)},className:r.CLASSES.VIDEO,src:s,poster:h,autoPlay:g,loop:E,muted:u,preload:v,controls:!1,crossOrigin:"anonymous",children:o&&o.map(a=>t.jsx("track",{kind:"subtitles",src:a.src,srcLang:a.srcLang,label:a.label,default:a.default},a.srcLang))}),K&&t.jsx("div",{className:r.CLASSES.LOADING,children:t.jsx("div",{className:r.CLASSES.SPINNER})}),i&&!Y&&t.jsxs("div",{className:`${r.CLASSES.CONTROLS} ${ve?r.CLASSES.CONTROLS_VISIBLE:""}`,children:[t.jsx("div",{className:r.CLASSES.PROGRESS_CONTAINER,children:t.jsxs("div",{className:r.CLASSES.PROGRESS_BAR,onClick:me,children:[t.jsx("div",{className:r.CLASSES.PROGRESS_BUFFERED,style:{width:`${oe()}%`}}),t.jsx("div",{className:r.CLASSES.PROGRESS_PLAYED,style:{width:`${ne()}%`}}),t.jsx("div",{className:r.CLASSES.PROGRESS_THUMB,style:{left:`${ne()}%`}})]})}),t.jsxs("div",{className:r.CLASSES.CONTROLS_ROW,children:[t.jsxs("div",{className:r.CLASSES.CONTROLS_LEFT,children:[t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:te,"aria-label":k?"Pause":"Play",children:k?t.jsx(ye,{size:20}):t.jsx(Ae,{size:20})}),t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:()=>w(O-10),"aria-label":"Skip back 10 seconds",children:t.jsx(ke,{size:20})}),t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:()=>w(O+10),"aria-label":"Skip forward 10 seconds",children:t.jsx(xe,{size:20})}),t.jsxs("div",{className:r.CLASSES.VOLUME_CONTAINER,children:[t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:ae,"aria-label":W?"Unmute":"Mute",children:W||I===0?t.jsx(Oe,{size:20}):t.jsx(Ie,{size:20})}),t.jsx("div",{className:r.CLASSES.VOLUME_SLIDER,children:t.jsx("div",{className:r.CLASSES.VOLUME_BAR,onClick:Ee,children:t.jsx("div",{className:r.CLASSES.VOLUME_FILL,style:{width:`${I*100}%`}})})})]}),t.jsxs("div",{className:r.CLASSES.TIME_DISPLAY,children:[t.jsx("span",{children:j(O)}),t.jsx("span",{children:"/"}),t.jsx("span",{children:j(M)})]})]}),t.jsxs("div",{className:r.CLASSES.CONTROLS_RIGHT,children:[pe&&t.jsxs("div",{className:r.CLASSES.SETTINGS_CONTAINER,children:[t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:()=>de(!se),"aria-label":"Settings",children:t.jsx(we,{size:20})}),se&&t.jsxs("div",{className:r.CLASSES.SETTINGS_MENU,children:[t.jsxs("div",{className:r.CLASSES.SETTINGS_TABS,children:[_&&_.length>1&&t.jsx("button",{className:`${r.CLASSES.SETTINGS_TAB} ${V==="quality"?r.CLASSES.SETTINGS_TAB_ACTIVE:""}`,onClick:()=>H("quality"),children:"Quality"}),t.jsx("button",{className:`${r.CLASSES.SETTINGS_TAB} ${V==="speed"?r.CLASSES.SETTINGS_TAB_ACTIVE:""}`,onClick:()=>H("speed"),children:"Speed"}),t.jsx("button",{className:`${r.CLASSES.SETTINGS_TAB} ${V==="subtitles"?r.CLASSES.SETTINGS_TAB_ACTIVE:""}`,onClick:()=>H("subtitles"),children:"Subtitles"})]}),t.jsxs("div",{className:r.CLASSES.SETTINGS_CONTENT,children:[V==="quality"&&_&&t.jsx("div",{className:r.CLASSES.SETTINGS_OPTIONS,children:_.map(a=>t.jsx("button",{className:`${r.CLASSES.SETTINGS_OPTION} ${(B==null?void 0:B.label)===a.label?r.CLASSES.SETTINGS_OPTION_ACTIVE:""}`,onClick:()=>d(a),children:a.label},a.label))}),V==="speed"&&t.jsx("div",{className:r.CLASSES.SETTINGS_OPTIONS,children:U.map(a=>t.jsxs("button",{className:`${r.CLASSES.SETTINGS_OPTION} ${ee===a?r.CLASSES.SETTINGS_OPTION_ACTIVE:""}`,onClick:()=>l(a),children:[a,"x"]},a))}),V==="subtitles"&&t.jsx("div",{className:r.CLASSES.SETTINGS_OPTIONS,children:o&&o.length>0?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:`${r.CLASSES.SETTINGS_OPTION} ${le===null?r.CLASSES.SETTINGS_OPTION_ACTIVE:""}`,onClick:()=>ie(null),children:"Off"}),o.map(a=>t.jsx("button",{className:`${r.CLASSES.SETTINGS_OPTION} ${le===a.srcLang?r.CLASSES.SETTINGS_OPTION_ACTIVE:""}`,onClick:()=>ie(a.srcLang),children:a.label},a.srcLang))]}):t.jsx("div",{className:r.CLASSES.SETTINGS_OPTION,style:{opacity:.6,cursor:"default"},children:"No subtitles available"})})]})]})]}),R&&t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:Ce,"aria-label":"Download video",children:t.jsx(Ve,{size:20})}),J&&t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:be,"aria-label":"Share video",children:t.jsx(je,{size:20})}),t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:e,"aria-label":"Picture in Picture",children:t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z"})})}),t.jsx("button",{className:r.CLASSES.CONTROL_BUTTON,onClick:re,"aria-label":D?"Exit fullscreen":"Enter fullscreen",children:D?t.jsx(_e,{size:20}):t.jsx(Pe,{size:20})})]})]})]})]})});Te.displayName="VideoPlayer";try{Te.displayName="VideoPlayer",Te.__docgenInfo={description:"Advanced Video Player Component",displayName:"VideoPlayer",props:{src:{defaultValue:null,description:"Video source URL or YouTube video ID",name:"src",required:!0,type:{name:"string"}},type:{defaultValue:{value:"video"},description:"Video player type",name:"type",required:!1,type:{name:"enum",value:[{value:'"video"'},{value:'"youtube"'}]}},youtubeId:{defaultValue:null,description:"YouTube video ID (alternative to src for YouTube videos)",name:"youtubeId",required:!1,type:{name:"string"}},poster:{defaultValue:null,description:"Poster image URL",name:"poster",required:!1,type:{name:"string"}},autoplay:{defaultValue:{value:"false"},description:"Whether video should autoplay",name:"autoplay",required:!1,type:{name:"boolean"}},loop:{defaultValue:{value:"false"},description:"Whether video should loop",name:"loop",required:!1,type:{name:"boolean"}},muted:{defaultValue:{value:"false"},description:"Whether video should be muted",name:"muted",required:!1,type:{name:"boolean"}},controls:{defaultValue:{value:"true"},description:"Whether to show custom controls",name:"controls",required:!1,type:{name:"boolean"}},preload:{defaultValue:{value:"metadata"},description:"Video preload setting",name:"preload",required:!1,type:{name:"enum",value:[{value:'"auto"'},{value:'"none"'},{value:'"metadata"'}]}},width:{defaultValue:null,description:"Video width",name:"width",required:!1,type:{name:"string | number"}},height:{defaultValue:null,description:"Video height",name:"height",required:!1,type:{name:"string | number"}},aspectRatio:{defaultValue:{value:"16:9"},description:"Aspect ratio (e.g., '16:9', '4:3')",name:"aspectRatio",required:!1,type:{name:"string"}},playbackRates:{defaultValue:{value:"[0.5, 0.75, 1, 1.25, 1.5, 2]"},description:"Available playback rates",name:"playbackRates",required:!1,type:{name:"number[]"}},quality:{defaultValue:null,description:"Available video qualities",name:"quality",required:!1,type:{name:"VideoQuality[]"}},subtitles:{defaultValue:null,description:"Available subtitles",name:"subtitles",required:!1,type:{name:"VideoSubtitle[]"}},chapters:{defaultValue:null,description:"Video chapters for navigation",name:"chapters",required:!1,type:{name:"VideoChapter[]"}},thumbnails:{defaultValue:null,description:"Thumbnail images for scrubbing",name:"thumbnails",required:!1,type:{name:"string[]"}},showDownload:{defaultValue:{value:"false"},description:"Whether to show download button",name:"showDownload",required:!1,type:{name:"boolean"}},showShare:{defaultValue:{value:"false"},description:"Whether to show share button",name:"showShare",required:!1,type:{name:"boolean"}},showSettings:{defaultValue:{value:"true"},description:"Whether to show settings menu",name:"showSettings",required:!1,type:{name:"boolean"}},ambientMode:{defaultValue:{value:"false"},description:"Enable ambient mode (YouTube-like background glow)",name:"ambientMode",required:!1,type:{name:"boolean"}},onPlay:{defaultValue:null,description:"Play event handler",name:"onPlay",required:!1,type:{name:"(() => void)"}},onPause:{defaultValue:null,description:"Pause event handler",name:"onPause",required:!1,type:{name:"(() => void)"}},onEnded:{defaultValue:null,description:"Ended event handler",name:"onEnded",required:!1,type:{name:"(() => void)"}},onTimeUpdate:{defaultValue:null,description:"Time update event handler",name:"onTimeUpdate",required:!1,type:{name:"((currentTime: number) => void)"}},onVolumeChange:{defaultValue:null,description:"Volume change event handler",name:"onVolumeChange",required:!1,type:{name:"((volume: number) => void)"}},onFullscreenChange:{defaultValue:null,description:"Fullscreen change event handler",name:"onFullscreenChange",required:!1,type:{name:"((isFullscreen: boolean) => void)"}},onError:{defaultValue:null,description:"Error event handler",name:"onError",required:!1,type:{name:"((error: Event) => void)"}},className:{defaultValue:{value:""},description:"Additional CSS class names",name:"className",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"Component disabled state",name:"disabled",required:!1,type:{name:"boolean"}}}}}catch{}export{Te as V};
